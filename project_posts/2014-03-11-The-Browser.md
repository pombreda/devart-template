In the last period I hit that wall in every software project's lifecycle where you need to take a break from the creative and fun part of coding and start taking care of infrastructure, setting up servers, configuring all sorts of scripts, fixing bugs, etc.

Since last time I blogged, I started playing around with [TileMill](https://www.mapbox.com/tilemill/). As I mentioned it before, it is a beautiful desktop application and I recommend it if you plan on styling your custom maps or map overlays. However, there were some limitations in using it. Firstly, I generated quite some big geojson files and TileMill had problems importing them as layers. They work fine in Mapnik, so I am assuming the problem lies with TileMill. Of course it could be that my geojson files are not correctly formatted, but I did not spend too much time investigating it. Also, my structure so far is pretty simple: meaning just lines and polygons, so I did not really take advantage of the css-like styling options. Still, it created a mapnik.xml file that needed almost no extra modifications.

Now, I had to render/serve all the image tiles. Of course I could use some python magic to pre-render all the tiles for all coordinates and zoom levels, but that would have wasted both time and disk space, so instead I went for rendering the tiles on demand. For this I used [TileStache](http://tilestache.org/), which is _"a Python-based server application that can serve up map tiles based on rendered geographic data"_. It can be configured to take a Mapnik xml file as datasource and it can render image tiles on demand, in a very similar way to Google Maps. So after some painful evenings of debugging researching different projections and standards (see [mercator](http://en.wikipedia.org/wiki/Mercator_projection) and [WGS84](http://en.wikipedia.org/wiki/World_Geodetic_System)) I managed to serve the tiles to a custom Google map! 

But with this occasion I learnt that debugging map related issues is really hard. Here is an example: I made it so that the generated map occupies an area roughly equal to the city I live in, [Cluj-Napoca](https://www.google.com/maps/@46.7705157,23.6009326,15z), and I managed to screw up some calculations related to latitude and longitude. As a result, the drawings were placed somewhere in Asia and I spent a lot of time assuming that there is a problem with the server configuration as all I could see was a blank map. When I realized the setup was ok and I was just looking at the wrong coordinates, I had no way of finding the actual drawing as it would have taken forever to drag-and-drop through a map at city-level zoom from Romania in all directions until I found Central Asia. Luckily I was also caching the tiles on disk and with the help of a pre-rendering script from Tilestache(tilestache-seed.py) I managed to get the coordinates where I had more information in the image than just a blank background. With this information, finding and fixing the bug was an easy task.

Below is a video of my browser accessing a local instance of the application. It uses the Einstein image shown in the previous posts but for a future version I am thinking of capturing the webcam stream from the browser and sending a snapshot to the server for processing. There are a lot of things to consider there such as hosting, security, caching, performance, etc. so I leave the subject for a future blog post. In the mean time, enjoy the preview:
http://www.youtube.com/watch?v=HX-Sn3gT_is